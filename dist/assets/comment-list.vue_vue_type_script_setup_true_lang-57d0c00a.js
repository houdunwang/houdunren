import{_ as ee}from"./card-5e9a267c.js";import{i as oe,r as te,a as ne,E as se,l as ce,k as D}from"./element-plus-269c9c95.js";import{_ as le}from"./markdownEditor-67a8e707.js";import{F as z,r as b,h as re,o as c,c as u,G as L,b as n,K as _,a as i,u as o,B as ie,X as H,n as T,af as ae,Q as h,R as I,P as q,L as R,T as F,bF as me,J as x,a5 as de,S as N,a8 as P}from"./@vue-fc98776d.js";import{u as ue,o as _e}from"./vue-router-4dc5009b.js";import{_ as pe}from"./error-c67a23aa.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as fe}from"./markdownPreview-9a5cb2b1.js";import{_ as ye}from"./userAvatar.vue_vue_type_script_setup_true_lang-5d1165fd.js";import{h as A,a as K,c as G}from"./index-28f279b5.js";import{d as ve}from"./dayjs-2fa04b10.js";import{x as he,l as ge,I as be,J as ke,K as we}from"./@icon-park-3742eccb.js";const $e={class:"flex justify-center"},xe=z({__name:"image-preview",setup(g){const p=b(),s=b(!1),y=b();return re(()=>{y.value.querySelectorAll("img").forEach(m=>{m.addEventListener("click",()=>{p.value=m.src,s.value=!0})})}),(m,r)=>{const f=oe,a=te;return c(),u("main",{ref_key:"main",ref:y},[L(m.$slots,"default",{},void 0,!0),n(a,{modelValue:o(s),"onUpdate:modelValue":r[0]||(r[0]=w=>ie(s)?s.value=w:null),class:"dialog","append-to-body":!0},{default:_(()=>[i("div",$e,[n(f,{src:o(p),lazy:!0,class:"w-full"},null,8,["src"])])]),_:1},8,["modelValue"])],512)}}});const Ve=J(xe,[["__scopeId","data-v-c713d925"]]),O=()=>{const g=b([]),p=b({content:""});return{findAll:async(r,f)=>{g.value=await A.request({url:`comment?model=${r}&id=${f}`})},collection:g,add:async(r,f,a)=>await A.request({url:`comment?model=${r}&id=${f}`,method:"POST",data:a}),form:p,remove:async r=>{await A.request({url:`comment/${r}`,method:"DELETE"})}}},Ce=["id"],Ee={class:"flex items-center justify-between py-3 px-5 bg-white border border-gray-100 border-l border-r"},Ie={class:"flex gap-2"},qe={class:"flex flex-col justify-start"},Se={class:"flex text-sm font-bold text-gray-500 mb-1"},je={key:0,class:"flex items-center"},Be={class:"text-gray-700 flex items-center gap-3 text-xs"},Ae={class:"flex items-center gap-1"},Te={class:"flex flex-col justify-between px-5 opacity-90 border-l border-r border-b border-gray-100 bg-gray-50 comment-content"},ze={class:"p-5 border-t border-gray-100 py-3 input"},Le=z({__name:"comment-item",props:{model:{},mid:{},collection:{},comment:{}},setup(g){const{collection:p,comment:s,model:y,mid:m}=g,r=ue(),{request:f}=G(),{authorize:a}=K(),{add:w,remove:S}=O(),l=H({content:"",comment_id:s.comment_id||s.id,reply_user_id:s.user_id}),k=b(!1),j=f(async()=>{var t;if(!l.content.trim())return ne.error("评论内容不能为空");const e=await w(y,m,l);(t=p.find(v=>v.id==l.comment_id))==null||t.replys.push(e),k.value=!1,l.content="",T(()=>{var v;(v=document.querySelector(`#comment${e.id}`))==null||v.scrollIntoView({block:"start",behavior:"smooth"})})});T(()=>{const e=+r.query.commentId;e==s.id&&document.querySelector(`#comment${e}`).scrollIntoView({block:"start",behavior:"smooth"})});const V=async e=>{await se.confirm("确定删除评论吗？"),await S(s.id);const t=document.querySelector(`#comment${s.id}`);t.style.display="none"};return(e,t)=>{const v=ye,C=ae("router-link"),E=he,B=ge,d=be,$=ke,Q=fe,X=Ve,W=ce,Y=pe,Z=D;return c(),u("section",{class:"mb-3 overflow-hidden",id:`comment${e.comment.id}`},[i("div",Ee,[i("div",Ie,[n(v,{user:e.comment.user,class:"w-9 h-9"},null,8,["user"]),i("div",qe,[i("div",Se,[n(C,{to:{name:"sign.space",query:{uid:e.comment.user_id}}},{default:_(()=>[h(I(e.comment.user.nickname),1)]),_:1},8,["to"]),e.comment.comment_id?(c(),u("div",je,[n(E,{theme:"outline"}),n(C,{to:{name:"sign.space",query:{uid:e.comment.reply_user_id}}},{default:_(()=>[h(I(e.comment.reply_user.nickname),1)]),_:1},8,["to"])])):q("",!0)]),i("div",Be,[i("div",Ae,[n(B,{theme:"outline"}),h(" "+I(o(ve)(e.comment.created_at).fromNow()),1)]),i("a",{href:"javascript:void(0)",class:"flex items-center gap-1 cursor-pointer",onClick:t[0]||(t[0]=M=>k.value=!o(k))},[n(d,{theme:"outline"}),h(" 回复 #"+I(e.comment.id),1)])])])]),o(a)(e.comment.user_id)?(c(),u("span",{key:0,class:"cursor-pointer text-gray-600 hover:text-red-600 text-xs",onClick:V},[n($,{theme:"outline"})])):q("",!0)]),i("div",Te,[n(X,null,{default:_(()=>[n(Q,{text:e.comment.html},null,8,["text"])]),_:1})]),R(i("div",ze,[n(W,{modelValue:o(l).content,"onUpdate:modelValue":t[1]||(t[1]=M=>o(l).content=M),rows:5,type:"textarea",placeholder:"支持markdown语法"},null,8,["modelValue"]),n(Y,{name:"content"}),n(Z,{type:"primary",size:"default",onClick:o(j),class:"mt-2"},{default:_(()=>[h("发表")]),_:1},8,["onClick"])],512),[[F,o(k)]]),L(e.$slots,"default",{},void 0,!0)],8,Ce)}}});const U=J(Le,[["__scopeId","data-v-d69ec1d2"]]),Me={key:0},Ne={class:"border-t"},Pe={id:"editor"},Ue={key:0,class:"mt-5"},De={key:1,class:"flex justify-center mt-5 border py-5 rounded-md"},eo=z({__name:"comment-list",props:{model:{},id:{}},async setup(g){let p,s;const{model:y,id:m}=g,{request:r}=G(),{isLogin:f}=K(),{collection:a,findAll:w,add:S}=O();[p,s]=me(()=>w(y,m)),await p,s();const l=H({content:"",key:1}),k=r(async()=>{const e=await S(y,m,l);a.value.push(e),T(()=>{var t;(t=document.querySelector(`#comment${e.id}`))==null||t.scrollIntoView({block:"start",behavior:"smooth"}),l.content="",l.key++})}),j=()=>{var e;(e=document.querySelector("#editor"))==null||e.scrollIntoView({block:"start",behavior:"smooth"})},V=b(!0);return _e(()=>{V.value=!1}),(e,t)=>{const v=we,C=le,E=D,B=ee;return c(),x(B,{class:"col-span-8 mb-5"},{header:_(()=>[L(e.$slots,"header",{},()=>[h("评论")])]),default:_(()=>[(c(),x(de,{to:"body"},[o(V)?(c(),u("div",{key:0,class:"fixed py-2 flex justify-center items-center bottom-[280px] right-5 cursor-pointer",onClick:j},[n(v,{theme:"filled",size:"40",fill:"#574b90"})])):q("",!0)])),o(a)?(c(),u("div",Me,[(c(!0),u(N,null,P(o(a),d=>(c(),x(U,{key:d.id,class:"mb-3",comment:d,collection:o(a),model:e.model,mid:e.id,id:`comment${d.id}`},{default:_(()=>[R(i("div",Ne,[(c(!0),u(N,null,P(d.replys,$=>(c(),x(U,{key:$.id,comment:$,collection:o(a),model:e.model,mid:e.id,id:`comment${$.id}`,class:"ml-10 my-2 bg-gray-50"},null,8,["comment","collection","model","mid","id"]))),128))],512),[[F,d.replys.length]])]),_:2},1032,["comment","collection","model","mid","id"]))),128))])):q("",!0),i("div",Pe,[o(f)()?(c(),u("section",Ue,[(c(),x(C,{modelValue:o(l).content,"onUpdate:modelValue":t[0]||(t[0]=d=>o(l).content=d),height:300,key:o(l).key},null,8,["modelValue"])),n(E,{type:"primary",size:"default",onClick:o(k),class:"mt-5"},{default:_(()=>[h("发表评论")]),_:1},8,["onClick"])])):(c(),u("section",De,[n(E,{type:"success",size:"large",onClick:t[1]||(t[1]=d=>e.$router.push({name:"login"}))},{default:_(()=>[h("请登录后发表评论")]),_:1})]))])]),_:3})}}});export{eo as _,Ve as a};
