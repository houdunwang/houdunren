import{j as v,l as B,m as I,k as S,p as Q,E as z,i as F,C as N,D as O}from"./element-plus-269c9c95.js";import{_ as T}from"./codeSend.vue_vue_type_script_setup_true_lang-e1f83257.js";import{_ as V}from"./error-c67a23aa.js";import{u as k,b as q,h as E}from"./index-28f279b5.js";import{F as x,X as H,o as r,c as u,u as t,b as e,P as C,K as a,Q as $,r as P,bF as A,W as M,J as U,B as W}from"./@vue-fc98776d.js";import"./lodash-es-d29772ce.js";import"./async-validator-dee29e8b.js";import"./@vueuse-338b0492.js";import"./@element-plus-828baf85.js";import"./dayjs-2fa04b10.js";import"./@kangc-b0092abd.js";import"./vue-d4d0ec31.js";import"./@sxzz-c75af06c.js";import"./escape-html-9595eff5.js";import"./normalize-wheel-es-ed76fb12.js";import"./@ctrl-f8748455.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./pinia-883c818f.js";import"./vue-demi-71ba0ef2.js";/* empty css                    */import"./vue-router-4dc5009b.js";import"./@icon-park-3742eccb.js";import"./axios-4a70c6fc.js";import"./prismjs-f5ad2561.js";import"./highlight.js-d90016de.js";import"./vee-validate-30786abe.js";import"./@vee-validate-f9e0ad5b.js";import"./yup-752d7be0.js";import"./property-expr-38205fa5.js";import"./toposort-39c4f588.js";const j={key:0,class:"mb-2"},D=x({__name:"email",setup(w){const{user:l}=k(),{updateEmail:i}=q(),o=H({account:"",code:""});return(m,n)=>{var y;const s=v,_=B,p=V,d=I,f=T,b=S,h=Q;return r(),u("main",null,[(y=t(l))!=null&&y.email?(r(),u("div",j,[e(s,{title:`已经绑定邮箱 ${t(l).email}`,type:"success",effect:"light","show-icon":"",closable:"",class:"mb-3"},null,8,["title"])])):C("",!0),e(h,{"label-width":"80px",inline:!1,size:"large",class:"border p-5 rounded-2xl"},{default:a(()=>[e(d,{label:"邮箱"},{default:a(()=>[e(_,{type:"email",modelValue:t(o).account,"onUpdate:modelValue":n[0]||(n[0]=c=>t(o).account=c),placeholder:"请输入新邮箱"},null,8,["modelValue"]),e(p,{name:"account"})]),_:1}),e(d,{label:"验证码"},{default:a(()=>[e(f,{code:t(o).code,"onUpdate:code":n[1]||(n[1]=c=>t(o).code=c),account:t(o).account,"onUpdate:account":n[2]||(n[2]=c=>t(o).account=c),type:"no-exists",class:"mt-3 w-full"},null,8,["code","account"])]),_:1}),e(d,null,{default:a(()=>[e(b,{type:"primary",onClick:n[3]||(n[3]=c=>t(i)(t(o)))},{default:a(()=>[$("确定修改")]),_:1})]),_:1})]),_:1})])}}}),J={key:0,class:"mb-2"},K=x({__name:"mobile",setup(w){const{updateMobile:l}=q(),i=k(),o=H({account:"",code:""}),m=async()=>{await l(o)};return(n,s)=>{var c;const _=v,p=B,d=V,f=I,b=T,h=S,y=Q;return r(),u("main",null,[(c=t(i).user)!=null&&c.mobile?(r(),u("div",J,[e(_,{title:`已绑定手机号 ${t(i).user.mobile}`,type:"success",effect:"light","show-icon":"",closable:"",class:"mb-3"},null,8,["title"])])):C("",!0),e(y,{"label-width":"80px",inline:!1,size:"large",class:"border p-5 rounded-2xl"},{default:a(()=>[e(f,{label:"手机"},{default:a(()=>[e(p,{modelValue:t(o).account,"onUpdate:modelValue":s[0]||(s[0]=g=>t(o).account=g),placeholder:"请输入手机号"},null,8,["modelValue"]),e(d,{name:"account"})]),_:1}),e(f,{label:"验证码"},{default:a(()=>[e(b,{code:t(o).code,"onUpdate:code":s[1]||(s[1]=g=>t(o).code=g),account:t(o).account,"onUpdate:account":s[2]||(s[2]=g=>t(o).account=g),type:"no-exists",class:"w-full"},null,8,["code","account"])]),_:1}),e(f,null,{default:a(()=>[e(h,{type:"primary",onClick:m},{default:a(()=>[$("确定修改")]),_:1})]),_:1})]),_:1})])}}}),L=()=>{const w=k(),l=P();return{bind:async()=>{var n;await E.request({url:`wechat/bind/${(n=l.value)==null?void 0:n.ticket}`,method:"POST"}),k().getCurrentUser()},unbind:async()=>{z.confirm("确定解除绑定吗？").then(async()=>{await E.request({url:"wechat/unbind",method:"POST"}),w.getCurrentUser()})},getScanQr:async()=>{l.value=await E.request({url:"wechat/scanloginQr",method:"POST"})},qr:l}},R={key:0,class:"flex flex-col items-start"},X={key:1},G=x({__name:"wechat",async setup(w){let l,i;const{bind:o,unbind:m,qr:n,getScanQr:s}=L();[l,i]=A(()=>s()),await l,i();const _=k(),p=setInterval(async()=>{_.wechatIsBind?clearInterval(p):await o()},3e3);return M(()=>{console.log("onUnmounted"),clearInterval(p)}),(d,f)=>{const b=v,h=S,y=F,c=V;return r(),u("main",null,[t(_).wechatIsBind?(r(),u("div",R,[e(b,{title:"微信已经绑定",type:"success",effect:"light","show-icon":"",closable:!1}),e(h,{type:"danger",size:"default",onClick:t(m),class:"mt-3"},{default:a(()=>[$(" 解绑微信 ")]),_:1},8,["onClick"])])):(r(),u("div",X,[e(b,{title:"请用微信扫描下方二维码",type:"success",effect:"light","show-icon":"",closable:!1}),t(n)?(r(),U(y,{key:0,src:`/api/wechat/scanLoginQrImage/${t(n).ticket}`,onClick:t(s),fit:"fill",lazy:!0,class:"border rounded-md cursor-pointer w-48 h-48 mt-2"},null,8,["src","onClick"])):C("",!0),e(c,{name:"wechat"})]))])}}}),Ve=x({__name:"bind",setup(w){const l=P("mobile");return(i,o)=>{const m=N,n=O;return r(),U(n,{modelValue:t(l),"onUpdate:modelValue":o[0]||(o[0]=s=>W(l)?l.value=s:null),type:"card","tab-position":"top"},{default:a(()=>[e(m,{label:"手机绑定",name:"mobile"},{default:a(()=>[e(K)]),_:1}),e(m,{label:"邮箱绑定",name:"email"},{default:a(()=>[e(D)]),_:1}),e(m,{label:"微信绑定",name:"wechat"},{default:a(()=>[t(l)=="wechat"?(r(),U(G,{key:0})):C("",!0)]),_:1})]),_:1},8,["modelValue"])}}});export{Ve as default};
