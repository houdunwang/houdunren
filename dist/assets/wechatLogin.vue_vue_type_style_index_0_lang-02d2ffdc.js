import{i as E,r as L}from"./element-plus-269c9c95.js";import{h,C as l,g as k,c as C}from"./index-28f279b5.js";import{r as p,F as R,o as r,c as i,u as s,b as c,K as T,a as e,B as b}from"./@vue-fc98776d.js";import{o as I}from"./vue-router-4dc5009b.js";import{W as f}from"./@icon-park-3742eccb.js";const u=k(),N=()=>{const o=p();return{scanLogin:async()=>{var a;if(!((a=o.value)!=null&&a.ticket))return;const{token:n}=await h.request({url:`wechat/sancLogin/${o.value.ticket}`,method:"POST"},{loading:!1});if(n){u.set(l.TOKEN_NAME,n);const t=u.get(l.REDIRECT_ROUTE_NAME,"/");u.remove(l.REDIRECT_ROUTE_NAME),location.href=t}},scanLoginQr:async()=>{o.value=await h.request({url:"wechat/scanloginQr",method:"POST"})},qr:o}},Q={key:0,class:"bg-green-700 rounded-full w-8 h-8 cursor-pointer flex justify-center items-center mt-3",href:"/wechat/appLogin"},B={key:1},O={class:"hidden md:flex flex-col"},V=e("div",{class:"text-center p-2 text-green-700"},"请使用微信扫码",-1),q=e("div",{class:"text-center text-gray-600"},"二维码失效时，请点击刷新",-1),D=e("div",{class:"flex flex-col md:hidden"},[e("h2",{class:"font-bold"},"温馨提示"),e("p",null,"手机端请关注公众号【后盾云】，使用微信登录学习")],-1),S=R({__name:"wechatLogin",setup(o){const{isWechat:d}=C(),{scanLogin:_,scanLoginQr:n,qr:a}=N(),t=p(!1),m=async()=>{await n(),t.value=!0},v=setInterval(()=>_(),3e3);return I(()=>{clearInterval(v)}),(U,g)=>{const w=E,x=L;return r(),i("main",null,[s(d)()?(r(),i("a",Q,[c(s(f),{theme:"outline",size:"24",class:"text-white"})])):(r(),i("section",B,[c(x,{modelValue:s(t),"onUpdate:modelValue":g[0]||(g[0]=y=>b(t)?t.value=y:null),class:"wechat-login-dialog","append-to-body":""},{default:T(()=>[e("div",O,[c(w,{src:`/api/wechat/scanLoginQrImage/${s(a).ticket}`,onClick:m,fit:"fill",lazy:!0,class:"border rounded-md cursor-pointer"},null,8,["src"]),V,q]),D]),_:1},8,["modelValue"]),e("div",{class:"bg-green-700 rounded-full w-8 h-8 cursor-pointer flex justify-center items-center",onClick:m},[c(s(f),{theme:"outline",size:"24",class:"text-white"})])]))])}}});export{S as _};
